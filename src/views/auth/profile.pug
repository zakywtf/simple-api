extends ../layouts/base

block content
	-function prettyDate(dateString){
		//if it's already a date object and not a string you don't need this line:
		-var date = new Date(dateString);
		-var d = date.getDate();
		-var monthNames = [ "Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember" ];
		-var m = monthNames[date.getMonth()];
		-var dayNames = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];
		-var currentDay = dayNames[date.getDay()];
		-var y = date.getFullYear();
		-return currentDay+', '+d+' '+m+' '+y;
	-}
	.container-fluid
		br
		//- br
		.container.profile-container
			.row
				.col-md-6
					.row 
						.col-md-12
							.card
								.card-body
									h4 Profil Anda
									br
									p
										strong NISN: 
										| #{data.nisn}
									p 
										strong Sekolah: 
										| #{data.school_id.name}
									p
										strong Nama: 
										| #{data.name}
									p
										strong Email:
										| #{data.email}
									p
										strong No. HP:
										| #{data.phone}
									p
										strong Jenis Kelamin:
										if (data.gender == 'male')
											| 
											| Laki-laki
										else 
											| 
											| Perempuan
									//- br
									//- br
									// Edit Button
									//- button#editButton.btn.btn-primary Edit Profile
					.row 
						.col-md-12
							// Edit Profile Form (Initially Hidden)
							#editForm(style="display: none;")
								.card
									.card-body
										h5.card-title Edit Profil
										form#profileForm.profile-form
											.mb-3
												label.form-label(for="editName") Nama
												input#editName.form-control(type="text", value=data.name, required)
											.mb-3
												label.form-label(for="editEmail") Email
												input#editEmail.form-control(type="email", value=data.email, required)
											.mb-3
												label.form-label(for="editPhone") No. HP
												input#editPhone.form-control(type="text", value=data.phone, required)

											button.btn.btn-success(type="submit") Simpan
											button#cancelButton.btn.btn-secondary(type="button") Batal
				.col-md-6 
					.card
						.card-body
							h5.card-title Ubah PIN
							#message.mt-3
							form.update-pin-form
								.mb-3
									label.form-label(for="currentPassword") PIN Lama
									input#currentPassword.form-control(type="password", required)
								.mb-3
									label.form-label(for="newPassword") PIN Baru
									input#newPassword.form-control(type="password", required)
								.mb-3
									label.form-label(for="confirmPassword") Konfirmasi PIN Baru
									input#confirmPassword.form-control(type="password", required)
								button.btn.btn-primary(type="submit") Simpan


	script(src="https://code.jquery.com/jquery-3.5.1.min.js")
	script(src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js")
	script.
		// DOM elements
		const editButton = document.getElementById('editButton');
		const editForm = document.getElementById('editForm');
		const profileInfo = document.querySelector('.card-body');
		const cancelButton = document.getElementById('cancelButton');
		const profileForm = document.getElementById('profileForm');

		// Handle the 'Edit Profile' button click
		editButton.addEventListener('click', () => {
			// Hide the profile info and show the edit form
			profileInfo.style.display = 'none';
			editForm.style.display = 'block';
		});

		// Handle the 'Cancel' button click to go back to profile view
		cancelButton.addEventListener('click', () => {
			// Hide the edit form and show the profile info again
			profileInfo.style.display = 'block';
			editForm.style.display = 'none';
		});

		// Handle form submission (this can be connected to a backend)
		profileForm.addEventListener('submit', (event) => {
			event.preventDefault();

			// Get the updated values from the form
			const updatedName = document.getElementById('editName').value;
			const updatedEmail = document.getElementById('editEmail').value;
			const updatedPhone = document.getElementById('editPhone').value;
			const updatedAddress = document.getElementById('editAddress').value;

			// Update the profile information (this can be done by sending the data to a server)
			alert(`Profile updated:
			Name: ${updatedName}
			Email: ${updatedEmail}
			Phone: ${updatedPhone}
			Address: ${updatedAddress}`);

			// For demonstration, we'll just show the updated values in the profile view
			profileInfo.innerHTML = `
				<h5 class="card-title">Profile Information</h5>
				<p><strong>Name:</strong> ${updatedName}</p>
				<p><strong>Email:</strong> ${updatedEmail}</p>
				<p><strong>Phone:</strong> ${updatedPhone}</p>
				<p><strong>Address:</strong> ${updatedAddress}</p>
				<button class="btn btn-primary" id="editButton">Edit Profile</button>
			`;

			// Hide the edit form and show the profile info again
			profileInfo.style.display = 'block';
			editForm.style.display = 'none';
		});

	script.
		const form = document.querySelector('.update-pin-form');
		form.addEventListener('submit', function (event) {
			event.preventDefault();

			const currentPassword = document.getElementById('currentPassword').value;
			const newPassword = document.getElementById('newPassword').value;
			const confirmPassword = document.getElementById('confirmPassword').value;

			if (newPassword !== confirmPassword) {
				$('#message').html('<div class="alert alert-danger">PIN baru tidak cocok.</div>');
				return;
			} 
			else {
				// AJAX GET request
				var host = window.location.origin;
				const token = localStorage.getItem('token');
				$.ajax({
					url: host + '/api/v1/auth/update-pin', // Example API
					method: 'POST',
					headers: {
						'Authorization': 'Bearer ' + token // Include the token in the header
					},
					contentType: 'application/json',
					data: JSON.stringify({currentPassword: currentPassword, newPassword: newPassword}),
					success: function(response) {
						console.log({response})
						if (response.status == 200) {
							$('#message').html('<div class="alert alert-success">PIN berhasil di perbaharui.</div>');
						} else {
							$('#message').html('<div class="alert alert-danger">' + response.message + '</div>');
						}
					},
					error: function(xhr, status, error) {
						//- console.log({xhr, status, error})
						console.error('Error submitting data: ', error);
						$('#response-container').html('<p>Error submitting data. Please try again later.</p>');
					}
				});
			}
		});