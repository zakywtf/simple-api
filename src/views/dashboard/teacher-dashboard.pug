#response-container.alert.alert-danger(role="alert", style="display:none;")

.row 
	.col-lg-3
		.card
			.card-body
				.row.alig.n-items-start
					.col-8
						//- h5.card-title.mb-9.fw-semibold Jumlah Pegawai
						p.fw-semibold.mb-3(style="font-size: 1.3rem; color: black;")
							b(style="font-size: 1.53125rem") #{total_kurus}
							|
							| Pegawai
					.col-4
						.d-flex.justify-content-end
							.text-white.bg-primary.rounded-circle.p-6.d-flex.align-items-center.justify-content-center
								i.ti.ti-weight.fs-6
				.row.alig.n-items-start
					.col-12 
						h6.text-primary Kekurangan Berat Badan
						p(style="font-size: 14px; text-decoration: underline;").text-normal
							a(href='/users/bmi-category?cat=kekurangan berat badan') lihat daftar nama


	.col-lg-3
		.card
			.card-body
				.row.alig.n-items-start
					.col-8
						p.fw-semibold.mb-3(style="font-size: 1.3rem; color: black;")
							b(style="font-size: 1.53125rem") #{total_normal}
							|
							| Pegawai
					.col-4
						.d-flex.justify-content-end
							.text-white.bg-success.rounded-circle.p-6.d-flex.align-items-center.justify-content-center
								i.ti.ti-weight.fs-6
				.row.alig.n-items-start
					.col-12 
						h6.text-success Normal
						p(style="font-size: 14px; text-decoration: underline;").text-normal
							a(href='/users/bmi-category?cat=normal') lihat daftar nama
	.col-lg-3
		.card
			.card-body
				.row.alig.n-items-start
					.col-8
						p.fw-semibold.mb-3(style="font-size: 1.3rem; color: black;")
							b(style="font-size: 1.53125rem") #{total_gemuk}
							|
							| Pegawai
					.col-4
						.d-flex.justify-content-end
							.text-white.bg-warning.rounded-circle.p-6.d-flex.align-items-center.justify-content-center
								i.ti.ti-weight.fs-6
				.row.alig.n-items-start
					.col-12 
						h6.text-warning Kelebihan Berat Badan
						p(style="font-size: 14px; text-decoration: underline;").text-normal
							a(href='/users/bmi-category?cat=kelebihan berat badan') lihat daftar nama

	.col-lg-3
		.card
			.card-body
				.row.alig.n-items-start
					.col-8
						p.fw-semibold.mb-3(style="font-size: 1.3rem; color: black;")
							b(style="font-size: 1.53125rem") #{total_obesitas}
							|
							| Pegawai
					.col-4
						.d-flex.justify-content-end
							.text-white.bg-danger.rounded-circle.p-6.d-flex.align-items-center.justify-content-center
								i.ti.ti-weight.fs-6
				.row.alig.n-items-start
					.col-12 
						h6.text-danger Obesitas
						p(style="font-size: 14px; text-decoration: underline;").text-normal
							a(href='/users/bmi-category?cat=obesitas') lihat daftar nama

.row
	.col-lg-12.d-flex.align-items-strech
		.card.w-100
			.row 
				.col-lg-9
					.card-body
						.d-sm-flex.d-block.align-items-center.justify-content-between.mb-9
							.mb-3.mb-sm-0
								h5.card-title.fw-semibold Laporan Bulanan
							div
								select#monthSelect.form-select
						//- 		select.form-select
						//- 			option(value="1") Januari #{year}
						//- 			option(value="2") Februari #{year}
						//- 			option(value="3") Maret #{year}
						//- 			option(value="4") April #{year}
						//- 			option(value="5") Mei #{year}
						//- 			option(value="6") Juni #{year}
						//- 			option(value="7") Juli #{year}
						//- 			option(value="8") Agustus #{year}
						//- 			option(value="9") September #{year}
						//- 			option(value="10") Oktober #{year}
						//- 			option(value="11") November #{year}
						//- 			option(value="12") Desember #{year}
						//- p#selectedValue Laporan Bulanan: 
						p#selectedMonth
						#weight-chart
						//- img.text-center(src="/assets/images/wellness.png", alt="...", width="350", height="300")
				.col-lg-3 
					.row 
						.col-lg-12
							.card
								.card-body
									.row.alig.n-items-start
										.col-8
											h5.card-title.mb-9.fw-semibold  Total Pegawai
											h3.fw-semibold.mb-3 #{total_users}
										.col-4
											.d-flex.justify-content-end
												.text-white.bg-warning.rounded-circle.p-6.d-flex.align-items-center.justify-content-center
													i.ti.ti-users.fs-6
					.row 
						.col-lg-12
							.card
								.card-body
									.row.alig.n-items-start
										.col-8
											h5.card-title.mb-9.fw-semibold  Laki-laki
											h3.fw-semibold.mb-3 #{total_male}
										.col-4
											.d-flex.justify-content-end
												.text-white.bg-primary.rounded-circle.p-6.d-flex.align-items-center.justify-content-center
													i.ti.ti-gender-male.fs-6
					.row 
						.col-lg-12
							.card
								.card-body
									.row.alig.n-items-start
										.col-8
											h5.card-title.mb-9.fw-semibold  Perempuan
											h3.fw-semibold.mb-3 #{total_female}
										.col-4
											.d-flex.justify-content-end
												.text-white.bg-success.rounded-circle.p-6.d-flex.align-items-center.justify-content-center
													i.ti.ti-gender-female.fs-6

script(src="https://code.jquery.com/jquery-3.5.1.min.js")
script(src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js")
script(src="https://cdn.jsdelivr.net/npm/apexcharts")
script.
	const host = window.location.origin;
	const token = localStorage.getItem('token');
	
	$(document).ready(function() {
		const status = localStorage.getItem('status');
		if (status == 'unpaid') {
			console.log({status})
			var error = document.getElementById("response-container");
			error.style.display = "block";
			$('#response-container').html('<p>Instansi anda telat melakukan pembayaran. Silahkan hubungi admin agar akun anda tidak di bekukan.</p>');
		}
	})
	const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
	const currentDate = new Date();
	const currentMonthIndex = currentDate.getMonth();
	const select = document.getElementById('monthSelect');

	months.forEach((month, index) => {
		const option = document.createElement('option');
		option.value = index + 1;
		option.textContent = month;
		if (index === currentMonthIndex) {
			option.selected = true;
		}
		select.appendChild(option);
	});

	function getChart(month) {
		$.ajax({
			url: host + '/api/v1/users/bmi/charts/'+month,
			type: 'GET',
			headers: {
				'Content-Type': 'application/json',
				'Authorization': `Bearer ${token}`
			},
			success: function(response) {
				console.log(response);
				if (response.status == 200){
					const data = [
						{ date: "2024-02-01", name: "A", amount: 10 },
						{ date: "2024-02-01", name: "B", amount: 15 },
						{ date: "2024-02-01", name: "D", amount: 11 },
						{ date: "2024-02-01", name: "A", amount: 5 },
						{ date: "2024-02-02", name: "A", amount: 8 },
						{ date: "2024-02-02", name: "B", amount: 12 },
						{ date: "2024-02-02", name: "A", amount: 7 },
						{ date: "2024-02-02", name: "B", amount: 10 },
						{ date: "2024-02-03", name: "C", amount: 20 },
						{ date: "2024-02-03", name: "D", amount: 11 }
					];
					// Proses grouping dan penjumlahan data
					const groupedData = response.data.reduce((acc, { date, name, amount }) => {
						if (!acc[date]) acc[date] = {};
						if (!acc[date][name]) acc[date][name] = 0;
						acc[date][name] += amount; // Menjumlahkan nilai jika produk sama
						return acc;
					}, {});

					// Ambil daftar produk unik
					const uniquenames = [...new Set(response.data.map(item => item.name))];

					// Ubah hasil grouping menjadi format untuk ApexCharts
					const series = uniquenames.map(name => ({
						name: name,
						data: Object.keys(groupedData).map(date => ({
							x: date,
							y: groupedData[date][name] || 0 // Jika tidak ada produk pada tanggal itu, gunakan 0
						}))
					}));
					console.log({series})
					// Konfigurasi Chart ApexCharts
					const options = {
						chart: {
							type: "bar",
							height: 400,
							stacked: true // Menumpuk nilai di dalam batang
						},
						series: series,
						xaxis: {
							type: "category",
							categories: Object.keys(groupedData) // Tanggal sebagai kategori
						},
						dataLabels: {
							enabled: true
						}
					};

					
					var chart = new ApexCharts(document.querySelector("#weight-chart"), options);
					chart.render();
					new ApexCharts(document.querySelector("#weight-chart"), options).render();
					function refreshChart() {
						//- var newData = [Math.floor(Math.random() * 100), Math.floor(Math.random() * 100)];
						chart.updateSeries(series);
					}
					refreshChart()
				}
			},
			error: function(xhr, status, error) {
				console.error('Error: ' + error);
			}
		});
	}


	document.getElementById('selectedMonth').textContent = 'Jumlah Pegawai berdasarkan kondisi BMI di bulan ' + months[select.selectedIndex];
	getChart(select.selectedIndex)

	select.addEventListener('change', function() {
		document.getElementById('selectedMonth').textContent = 'Jumlah Pegawai berdasarkan kondisi BMI di bulan ' + months[select.selectedIndex];
		getChart(select.selectedIndex)
	});