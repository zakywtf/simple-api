<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ApexCharts Grouping by Date</title>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>
<body>

    <div id="chart"></div>

    <script>
        // Data awal
        const rawData = [
            { date: "2024-02-01", product: "A", amount: 10 },
            { date: "2024-02-01", product: "B", amount: 15 },
            { date: "2024-02-01", product: "D", amount: 11 },
            { date: "2024-02-01", product: "A", amount: 5 },
            { date: "2024-02-02", product: "A", amount: 8 },
            { date: "2024-02-02", product: "B", amount: 12 },
            { date: "2024-02-02", product: "A", amount: 7 },
            { date: "2024-02-02", product: "B", amount: 10 },
            { date: "2024-02-03", product: "C", amount: 20 },
            { date: "2024-02-03", product: "D", amount: 11 }
        ];

        // Proses grouping dan penjumlahan data
        const groupedData = rawData.reduce((acc, { date, product, amount }) => {
            if (!acc[date]) acc[date] = {};
            if (!acc[date][product]) acc[date][product] = 0;
            acc[date][product] += amount; // Menjumlahkan nilai jika produk sama
            return acc;
        }, {});

        // Ambil daftar produk unik
        const uniqueProducts = [...new Set(rawData.map(item => item.product))];

        // Ubah hasil grouping menjadi format untuk ApexCharts
        const series = uniqueProducts.map(product => ({
            name: product,
            data: Object.keys(groupedData).map(date => ({
                x: date,
                y: groupedData[date][product] || 0 // Jika tidak ada produk pada tanggal itu, gunakan 0
            }))
        }));

        // Konfigurasi Chart ApexCharts
        const options = {
            chart: {
                type: "bar",
                height: 400,
                stacked: true // Menumpuk nilai di dalam batang
            },
            series: series,
            xaxis: {
                type: "category",
                categories: Object.keys(groupedData) // Tanggal sebagai kategori
            },
            dataLabels: {
                enabled: true
            }
        };

        // Render Chart
        const chart = new ApexCharts(document.querySelector("#chart"), options);
        chart.render();
    </script>

</body>
</html>
